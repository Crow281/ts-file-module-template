# Scripts

A guide to all the NPM scripts built into this project for anyone developing it.

## Generate

The parent script for all programmatic code generation in this project.
This script will delete any existing programmatic code via script clean:generate
and then activate all the subscripts specified below.

```console
npm run generate
```

### Generate: JSON Schema

[JSON Schema](https://json-schema.org/)
is a file format used to define
the correct structure for a type of JSON document.
This project contains several scripts for dynamically generating code useful for
JSON Schema files.

For example, if you have a file,
{project}/src/some/module/SomeSchema.schema.json,
you can use this script to generate
a TypeScript interface representing the data
the schema represents,
a validation function verifying that a given
JSON object matches the schema,
and an object mapping all JSON Schema ids
to the corresponding JSON Schema.
This will result in the creation of the following files:
- {project}/src/some/module/SomeSchema.ts
- {project}/src/some/module/ValidateSomeSchema.ts
- {project}/src/internal/IDToJSONSchema.ts

You can add your JSON Schema to anywhere inside of
"{project}/src".

If your JSON Schema is only intended for internal use,
you can just add it to an internal folder
(e.g. the glob pattern would be "./src/\*\*/internal/\*\*/\*.schema.json").

The following script is the parent script for all JSON Schema generation
code in this project.

```console
npm run generate:json-schema
```

#### Generate: JSON Schema: ID Mapping

Creates a const object, mapping strings with JSON Schema ids to the actual JSON schema object.

The generated module is stored to path
"{project}/src/internal/IDToJSONSchema.ts"
inside an internal folder, as it is for your library's internal use only.

```console
npm run generate:json-schema:id-mapping
```

#### Generate: JSON Schema: Interfaces

Creates TypeScript interfaces for each JSON Schema object in the source folder,
representing the JSON Objects they define.

Each TypeScript interface file will be placed in the same folder as the original JSON Schema.

```console
npm run generate:json-schema:interfaces
```

#### Generate: JSON Schema: Validators

Creates JSON Schema validators, capable of determining whether a given variable is a valid instance of the JSON Schema and corresponding TypeScript interface.

Each JSON Schema validator file will be placed in the same folder as the original JSON Schema.

```console
npm run generate:json-schema:validators
```

When running this script, you might notice the following error message:

```console
The following generated JSON Schema validators are dependant on NPM package "ajv-formats":
```

This happens when your JSON Schema code wants to validate a format,
but you do not have the "ajv-formats" package needed to do so
set as a project dependency.
You are advised to follow the warning's instructions to install
or move it.

## Knip

[Knip](https://www.npmjs.com/package/knip)
allows you to search your project for any unused dependencies and the like.

```console
npm run knip
```

The knip config file is located at: 
[{project}/config/knip/knip.config.ts](../config/knip/knip.config.ts)

If you have a package that is being used in a way that knip cannot
detect, then you can add its name to config property
ignoreDependencies.

If one of your files is conducting a valid import in a way that
knip does not recognize, then you can add it to config property
ignoreUnresolved.

## Lint

The following script allows you to use
[ESLint](https://www.npmjs.com/package/eslint)
to search your code for problems.

```console
npm run lint
```

## Format

This script allows you to use
[Prettier](https://www.npmjs.com/package/prettier)
to keep code formatting consistent, imports organized, etc.

```console
npm run format
```

## Clean

The parent script for all cleaning of this project, deleting files you don't need right now.

```console
npm run clean
```

### Clean: Coverage

Deletes the coverage report generated by Jest.

```console
npm run clean:coverage
```

### Clean: Generated

This script will delete all files created by the generate script.

```console
npm run clean:generated
```

### Clean: Dist

This script will delete everything you built to the
"{project}/dist"
folder.

```console
npm run clean:dist
```

## Build

The parent script for all building this project into a distributable.

```console
npm run build
```

### Build: JS

This script will compile all of your scripts in the "{project}/src" folder
into JavaScript modules (e.g. CommonJS, ES), outputting them to the "{project}/dist" folder.

```console
npm run build:js
```

### Build: Types

This script will use the TypeScript compiler to build the type definitions
for each script file and output them to the "{project}/dist" folder.

```console
npm run build:types
```

### Build: Copy Types

This script will copy all custom written Type Definition (.d.ts) files
already stored to the source folder over to the "{project}/dist" folder.

```console
npm run build:copy-types
```

## Test

This project uses
[Jest](https://www.npmjs.com/package/jest)
for its test scripts.

You can write unit tests by adding a "__tests__"
folder,
adding ".test.ts" files to it, and writing your
tests inside of them.
You can then run them whenever you update your source code
to ensure that your changes haven't broken anything.

An example is located
[here](https://github.com/Crow281/ts-file-module-template/tree/main/src/math/linear-algebra/algorithms/__tests__/),
in the original template project,
which contains tests to make sure the code inside of
"src/math/linear-algebra/algorithms" is behaving as expected.

This command will activate Jest.

```console
npm run test
```

## Test All Versions

This script is a more expensive version
of the test script.
You would generally use it after a regular test and shortly before publishing.
It is intended to ensure that all the dependency version ranges
you specified in your package.json actually work correctly.

It will iterate all of your NPM dependencies/peerDependencies/optionalDependencies.
For each dependency, it will print the package and version range being tested against
[Jest](https://www.npmjs.com/package/jest)
and then run your Jest test suite on that.
If any of the test suites fail, then the test script will terminate
without testing any more package version ranges.

```console
npm run test-all-versions
```

## Document

This script allows you to use
[TypeDoc](https://www.npmjs.com/package/typedoc)
to build documentation for all your TypeScript files.
It outputs them to
"{project}/doc/api/latest"
as a series of web pages.
If you are using a public git, you are advised to wait until
all changes are committed so that it can link the documentation to
your source files.

```console
npm run doc
```

As a live example, the original template project this was derived from
provides the API for the sample code via GitHub Pages.
It is located
[here](https://crow281.github.io/ts-file-module-template/doc/api/latest).
Github hosts the files located
[here](https://github.com/Crow281/ts-file-module-template/tree/gh-pages/).

To do the same for a new project:
- Create your own new Git branch called "gh-pages".
- Commit the web resources generated by TypeDoc somewhere on this branch.
- Go to the Git project's settings and click on the "Pages" button
to open the GitHub Pages menu. You can select the "gh-pages" branch
to host it.

Whenever you have a major update, you will probably want to archive
the old documentation in a folder named after the version it referred to.
